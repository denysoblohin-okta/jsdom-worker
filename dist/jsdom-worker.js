var e=require("node-fetch");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=/*#__PURE__*/t(e);function o(e){return{all:e=e||new Map,on:function(t,n){var o=e.get(t);o?o.push(n):e.set(t,[n])},off:function(t,n){var o=e.get(t);o&&(n?o.splice(o.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var o=e.get(t);o&&o.slice().map(function(e){e(n)}),(o=e.get("*"))&&o.slice().map(function(e){e(t,n)})}}}var r,s,a=(r=function(e,t){t=e.exports=function(){for(var e,n="",o=0;o<32;o++)e=16*t.random()|0,o>4&&o<21&&!(o%4)&&(n+="-"),n+=(12===o?4:16===o?3&e|8:e).toString(16);return n};var n=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/;t.isUUID=function(e){return n.test(e)},t.random=function(){return Math.random()}},r(s={exports:{}},s.exports),s.exports);const i="object"==typeof global?global:"object"==typeof globalThis?globalThis:void 0;i.URL||(i.URL={});let l=i.URL.$$objects;if(!l){l=new Map,i.URL.$$objects=l,i.URL.createObjectURL=e=>{let t=a();return l[t]=e,`blob:http://localhost/${t}`},i.URL.revokeObjectURL=e=>{let t=String(e).match(/^blob:http:\/\/localhost\/(.+)$/);t&&delete l[t[1]]};const e=Blob;i.Blob=function(t,n){const o=new e(t,n);return o._arr=t,o}}if(!i.fetch||!("jsdomWorker"in i.fetch)){let t=i.fetch||n.default;i.fetch=function(n,o){let r="object"==typeof n?n.url||n.href:n;if(r.match(/^blob:/)){const t=r.match(/[^/]+$/)[0],n=l[t];return n._arr?n._arr[0]:new Promise((t,o)=>{let r=new FileReader;r.onload=()=>{t(new(i.Response||e.Response)(r.result,{status:200,statusText:"OK"}))},r.onerror=()=>{o(r.error)},r.readAsText(n)})}return t.call(this,n,o)},Object.defineProperty(i.fetch,"jsdomWorker",{configurable:!0,value:!0})}function c(e){this.type=e}i.document||(i.document={}),c.prototype.initEvent=Object,i.document.createEvent||(i.document.createEvent=function(e){return new(global[e]||c)(e)}),i.Worker=function(e,t){let n,r=[],s=o(),a=o(),l=!1,c={onmessage:null,dispatchEvent:s.emit,addEventListener:s.on,removeEventListener:s.off,postMessage(e){a.emit("message",{data:e})},fetch:i.fetch,importScripts(){}};s.on("message",e=>{if(l)return;let t=c.onmessage||n("onmessage");t&&t.call(c,e)}),this.addEventListener=a.on,this.removeEventListener=a.off,this.dispatchEvent=a.emit,a.on("message",e=>{this.onmessage&&this.onmessage(e)}),this.onmessage=null,this.postMessage=e=>{l||(null!=r?r.push(e):s.emit("message",{data:e}))},this.terminate=()=>{console.warn("Worker.prototype.terminate() not supported in jsdom-worker."),l=!0,r=null};const f=e=>{let t="var self=this,global=self";for(let e in c)t+=`,${e}=self.${e}`;n=Function(t+";\n"+e+'\nreturn function(n){return n=="onmessage"?onmessage:null;}').call(c);let o=r;r=null,o&&o.forEach(this.postMessage)},u=i.fetch(e);"string"==typeof u?f(u):u.then(e=>e.text()).then(e=>{f(e)}).catch(e=>{a.emit("error",e),console.error(e)})};
//# sourceMappingURL=jsdom-worker.js.map
